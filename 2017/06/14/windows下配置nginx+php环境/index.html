<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Black"><link rel="alternative" href="/atom.xml" title="小黑" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>windows下配置nginx+php环境 - 小黑</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">小黑</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2017-06-14T06:36:01.792Z">June 14, 2017</time><h1 class="post__title"><a href="/2017/06/14/windows下配置nginx+php环境/">windows下配置nginx+php环境</a></h1><div class="post__main echo"><p>1、首先需要准备的应用程序包。<br>    nginx：<a href="http://nginx.org/download/nginx-1.0.4.zip" target="_blank" rel="external">nginx/Windows-1.0.4</a><br>    php：<a href="http://windows.php.net/downloads/releases/archives/php-5.2.16-nts-Win32-VC6-x86.zip" target="_blank" rel="external">php-5.2.16-nts-Win32-VC6-x86.zip</a> （nginx下php是以FastCGI的方式运行，所以我们下载非线程安全也就是nts的php包）<br>    （还会用到）<a href="http://redmine.lighttpd.net/attachments/660/RunHiddenConsole.zip" target="_blank" rel="external">RunHiddenConsole：RunHiddenConsole.zip</a><br>    2、安装与配置。<br>    1）php的安装与配置。<br>　　直接解压下载好的php包，到D盘wnmp目录（D:\wnmp），这里把解压出来的文件夹重命名成php5。进入文件夹修改php.ini-recommended文件为php.ini，并用Editplus或者Notepad++打开来。找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">extension_dir = &quot;./ext&quot;</div></pre></td></tr></table></figure></p>
<p>更改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">extension_dir = &quot;D:/wnmp/php5/ext&quot;</div></pre></td></tr></table></figure></p>
<p>往下看，再找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">;extension=php_mysql.dll</div><div class="line">;extension=php_mysqli.dll</div></pre></td></tr></table></figure></p>
<p>前面指定了php的ext路径后，只要把需要的扩展包前面所对应的“;”去掉，就可以了。这里打开php_mysql.dll和php_mysqli.dll，让php支持mysql。当然不要忘掉很重要的一步就是，把php5目录下的libmysql.dll文件复制到C:\Windows目录下，也可以在系统变量里面指定路径，当然这里我选择了更为方便的方法。</p>
<p>到这里，php已经可以支持mysql了。</p>
<p>　　接下来我们来配置php，让php能够与nginx结合。找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">;cgi.fix_pathinfo=1</div></pre></td></tr></table></figure></p>
<p>我们去掉这里的封号。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cgi.fix_pathinfo=1</div></pre></td></tr></table></figure></p>
<p>这一步非常重要，这里是php的CGI的设置。<br>　2）nginx的安装与配置。</p>
<p>　　把下载好的nginx-1.0.4的包同样解压到D盘的wnmp目录下，并重命名为nginx。接下来，我们来配置nginx，让它能够和php协同工作。进入nginx的conf目录，打开nginx的配置文件nginx.conf，找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">      root   html;　　　　　　#这里是站点的根目录</div><div class="line">      index  index.html index.htm;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>将root  html;改为root   D:/wnmp/www;</p>
<p>再往下，找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</div><div class="line">#</div><div class="line">#location ~ \.php$ &#123;</div><div class="line">#    root           html;</div><div class="line">#    fastcgi_pass   127.0.0.1:9000;</div><div class="line">#    fastcgi_index  index.php;</div><div class="line">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</div><div class="line">#    include        fastcgi_params;</div><div class="line">#&#125;</div></pre></td></tr></table></figure></p>
<p>先将前面的“#”去掉，同样将root  html;改为root   D:/wnmp/www;。再把标记为红色的/scripts改为“$document_root”，这里的“$document_root”就是指前面“root”所指的站点路径，这是改完后的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</div><div class="line">#</div><div class="line">location ~ \.php$ &#123;</div><div class="line">      root           D:/wnmp/www;</div><div class="line">      fastcgi_pass   127.0.0.1:9000;</div><div class="line">      fastcgi_index  index.php;</div><div class="line">      fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">      include        fastcgi_params;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>保存配置文件，就可以了。<br>　首先把下载好的RunHiddenConsole.zip包解压到nginx目录内，RunHiddenConsole.exe的作用是在执行完命令行脚本后可以自动关闭脚本，而从脚本中开启的进程不被关闭。然后来创建脚本，命名为“start_nginx.bat”，我们在Notepad++里来编辑它<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line">REM Windows 下无效</div><div class="line">REM set PHP_FCGI_CHILDREN=5</div><div class="line"></div><div class="line">REM 每个进程处理的最大请求数，或设置为 Windows 环境变量</div><div class="line">set PHP_FCGI_MAX_REQUESTS=1000</div><div class="line"> </div><div class="line">echo Starting PHP FastCGI...</div><div class="line">RunHiddenConsole D:/wnmp/php5/php-cgi.exe -b 127.0.0.1:9000 -c D:/wnmp/php5/php.ini</div><div class="line"> </div><div class="line">echo Starting nginx...</div><div class="line">RunHiddenConsole D:/wnmp/nginx/nginx.exe -p D:/wnmp/nginx</div></pre></td></tr></table></figure></p>
<p>再另外创建一个名为stop_nginx.bat的脚本用来关闭nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line">echo Stopping nginx...  </div><div class="line">taskkill /F /IM nginx.exe &gt; nul</div><div class="line">echo Stopping PHP FastCGI...</div><div class="line">taskkill /F /IM php-cgi.exe &gt; nul</div><div class="line">exit</div></pre></td></tr></table></figure></p>
<p>做好后，是这样的<br><img src="/2017/06/14/windows下配置nginx+php环境/1.jpg" alt=""><br>这样，我们的服务脚本也都创建完毕了。双击start_nginx.bat看看进程管理器是不是有两个nginx.exe的进程和一个php-cgi.exe的进程呢？<br>这样nginx服务就启动了，而且php也以fastCGI的方式运行了。<br><img src="/2017/06/14/windows下配置nginx+php环境/2.jpg" alt=""><br>到站点目录下，新建一个phpinfo.php的文件，在里面编辑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">    phpinfo();</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
</div></header></article><section class="reward"> <a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="/img/wechat.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016-2017 Black</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>